<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.codex.kosiea.dao.UserDAO">

	<select id="userChk" parameterType="map" resultType="map">
		SELECT *
		  FROM MEMBERS
		 WHERE NAME = #{username}
		   AND TEL = ${tel}
           AND PASSWORD = ${password}
	</select>

    <!-- 로그인한 사용자 정보 -->
	<select id="findByUserID" resultType="User" parameterType="string">
		SELECT *
		  FROM MEMBERS
		 WHERE NAME = #{username}
	</select>

	<!-- 계정 등록 -->
	<insert id="insertUser" parameterType="map">
		INSERT INTO MEMBERS
		SET PASSWORD = #{password}
		  , NAME = #{name}
		  , KOB = #{kob}
		  , GENDER = #{gender}
		  , COMPANY = #{company}
		  , POSITION = #{position}
		  , BIRTHDAY = #{birthday}
		<if test="lunar_birthday != null and lunar_birthday != ''">
		  , LUNAR = #{lunar_birthday}
		</if>
		  , LUNAR_YN = #{lunar_yn}
		  , ADDR1 = #{addr1}
		  , ADDR2 = #{addr2}
		  , TEL = #{tel}
		  , FILE_LOCATION = #{file_location}
		  , FILE_LOCATION2 = #{file_location2}
		  , ROLE_CD = '1'
		  , ROLE_NM = '사용자'
		  , CREATE_DT = CURRENT_TIMESTAMP
		  , UPDATE_DT = CURRENT_TIMESTAMP
	</insert>


	<select id="idFailYnCheck" resultType="int" parameterType="map">
		SELECT COUNT(*) AS cnt
		  FROM MEMBERS
		 WHERE NAME = #{name}
		   AND REPLACE(TEL, '-', '') = #{tel}
	</select>

	<select id="failPasswordCheck" resultType="String" parameterType="map">
		SELECT PASSWORD
		  FROM MEMBERS
		 WHERE NAME = #{name}
		   AND REPLACE(TEL, '-', '') = #{tel}
	</select>

</mapper>